<!DOCTYPE html>
<html lang="en" xmlns="http://www.thymeleaf.org">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- Font Awesome -->
	 	<link rel="stylesheet" th:href="@{/plugins/fontawesome-free/css/all.min.css}"> 
		<!-- Ionicons -->
		<link rel="stylesheet" th:href="@{/dist/css/ionicons.css}">
		<!-- Tempusdominus Bbootstrap 4 -->
		<link rel="stylesheet" th:href="@{/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css}">
		<!-- iCheck -->
		<link rel="stylesheet" th:href="@{/plugins/icheck-bootstrap/icheck-bootstrap.min.css}">
		<!-- DataTables -->
  		<link rel="stylesheet" th:href="@{/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css}">
  		<link rel="stylesheet" th:href="@{/plugins/datatables-responsive/css/responsive.bootstrap4.min.css}">
		<!-- Theme style -->
		<link rel="stylesheet" th:href="@{/dist/css/adminlte.min.css}">
		<!-- overlayScrollbars -->
		<link rel="stylesheet" th:href="@{/plugins/overlayScrollbars/css/OverlayScrollbars.min.css}">	
		<!-- bootstrap-multiselect -->
		<link rel="stylesheet" th:href="@{/plugins/bootstrap-multiselect/css/bootstrap-multiselect.css}" >
	<style>
	
	.multiselect-container{ /*下拉框的样式*/
           width:200px;
       }
	</style>
	</head>
	<body>
   
      <!-- 新增页面模态框 -->
	<div class="modal fade" id="modal-default">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
             <div class='form-group' > 
				 	<div class='input-group-prepend' style="float:left;">
				 		<span class='input-group-text' >报文分组数</span>
				 	 <input class='form-control'oninput='value=value.replace(/[^\d]/g,"")' placeholder='请输入报文的分组数量' id='imesGroupCount'/>
	            	</div>     	
	             </div>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="false">&times;</span>
              </button>
            </div>
            <div class="modal-body" >
              	<!-- 模态框内容 -->
				<div id="addArea">
				</div>
				<div  id="addAreaX">
				<div class="form-group" >
					 <label for="imesId">报文标识</label>
					 <input class="form-control" placeholder="报文标识" id="imesId">
				</div>
				<div class="form-group">
					 <label for="imesName">报文名称</label>
					 <input class="form-control" placeholder="报文名称" id="imesName">
				</div>
				<div class="form-group">
					 <label for="imesDesc">报文描述</label>
					 <input class="form-control" placeholder="报文描述" id="imesDesc">
				</div>
				<div class="form-group">
					 <label for="imesRemark">报文备注</label>
					 <input class="form-control" placeholder="报文备注" id="imesRemark">
				</div>
				<div class="form-group">
					 <label for="imesSource">数据源</label>
					 <input class="form-control" placeholder="数据源" id="imesSource"  >
				</div>
				<div class="form-group">
					 <label for="imesDestination">目的地</label>
					 <input class="form-control" placeholder="目的地" id="imesDestination" >
				</div>
				<div class="form-group">
					 <label for="imesID">报文ID</label>
					 <input class="form-control" placeholder="报文ID" id="imesID" >
				</div>
				<div class="form-group">
					 <label for="imesFunId">功能码</label>
					 <input class="form-control" placeholder="功能码" id="imesFunId">
				</div>
				<div class="form-group">
					 <label for="imesTyp">报文类型</label>
					 <input class="form-control" placeholder="报文类型" id="imesTyp"  readonly='readonly'>
				</div>
				</div>
            </div>
            
            <div class="modal-footer justify-content-between">
              <button id='closeaddModal' type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
              <button id='saveaddModal' type="button" data-dismiss="modal" class="btn btn-primary" onclick="addSave();">保存</button>
            </div>
          </div>
        </div>
      </div>
	

		<!-- 表格相关 -->
		<div class="card-body">
			<button id='addBtn' type='button' style='float: right; margin-left:2%;width: 8%;'
				class='btn btn-block btn-outline-info btn-sm' data-toggle='modal'
				data-target='#modal-add' onclick='addClick();'>新增报文
			</button>
			<div style='float: right;'> 
				<select id="selectDestination" multiple="multiple" >
				</select>
			</div>  
			<div style='float: right;'> 
				<select id="selectSource" multiple="multiple" >
				</select>
			</div>

			<table id="example1" class="table table-bordered table-striped">
				<thead>
					<tr>
						<th>报文标识</th>
						<th>报文名称</th>
						<th>数据源</th>
						<th>目的地</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>

	
	<script th:src="@{/plugins/jquery/jquery.js}" ></script>
	<script type="module"th:src="@{/plugins/bootstrap/js/bootstrap.min.js}"></script>
	<script type="module"th:src="@{/plugins/popper/esm/popper.js}"></script>
	<script type="module"th:src="@{/plugins/popper/popper.js}"></script>
	<script th:src="@{/plugins/popper/umd/popper.js}"></script>
	
	
	<!-- jQuery -->
	<script th:src="@{/plugins/jquery/jquery.min.js}"></script>
	<!-- jQuery UI 1.11.4 -->
	<script th:src="@{/plugins/jquery-ui/jquery-ui.min.js}"></script>
	<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
	 <script>
	  $.widget.bridge('uibutton', $.ui.button)
	</script> 
	<!-- Bootstrap 4 -->
	<script th:src="@{/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js}"></script>
	<script th:src="@{/plugins/bootstrap-switch/js/bootstrap-switch.min.js}"></script>
	<script th:src="@{/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
	<!-- DataTables -->
	<script th:src="@{/plugins/datatables/jquery.dataTables.min.js}"></script>
	<script th:src="@{/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js}"></script>
	<script th:src="@{/plugins/datatables-responsive/js/dataTables.responsive.min.js}"></script>
	<script th:src="@{/plugins/datatables-responsive/js/responsive.bootstrap4.min.js}"></script>

	<!-- Sparkline -->
	<script th:src="@{/plugins/chart.js/Chart.min.js}"></script><script th:src="@{/plugins/sparklines/sparkline.js}"></script>
	<!-- bootstrap-multiselect -->
	<script  th:src="@{/plugins/bootstrap-multiselect/js/bootstrap-multiselect.js}"></script>
	<!-- jQuery Knob Chart -->
	<script th:src="@{/plugins/jquery-knob/jquery.knob.min.js}"></script>
	<!-- overlayScrollbars -->
	<script th:src="@{/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js}"></script>
	<!-- AdminLTE App -->
	<script th:src="@{/dist/js/adminlte.js}"></script>

	 
	<!-- page script -->
<script type="text/javascript">

function GetRequest() {
var url = location.search; //获取url中"?"符后的字串
var theRequest = new Object();
 if (url.indexOf("?") != -1) {
       var str = url.substr(1);
       strs = str.split("&");
       for (var i = 0; i < strs.length; i++) {
           theRequest[strs[i].split("=")[0]] = decodeURIComponent(strs[i].split("=")[1]);
       }
   }
   return theRequest;
}

//------全局变量-------
var a=GetRequest();//中间件菜单传值
var mesType=a['mesType'];
//------全局变量-------

function QryMessage(){//根据报文类型查所有报文
	$("#example1 tbody" ).empty();
	$.ajax({
		url:"/qryMessage.do",
		type:"POST",
		async:true,
		data:{"mesType":mesType},
		success:function(result){
			var body="";
			for(var i=0;i<result.length;i++){
				body = "<tr>";
				body    += "<td id='timesId'>" + result[i].mesId + "</td>";
		        body    += "<td id='tmesName'>" + result[i].mesName + "</td>";
		        body    += "<td id='tmesSource'>" + result[i].mesSource + "</td>";  
		        body    += "<td id='tmesDestination'>" + result[i].mesDestination + "</td>";
		        body    += "<td>"+
		        "<button id='detailBtn' type='button' style='width:23%;margin-top:6px;float:left;'class='btn btn-block btn-outline-success btn-sm' data-toggle='modal' data-target='#modal-detail'onclick='showDetail(this)'>报文详情</button> "+
		        "<button id='editIBtn' type='button' style='margin-left:3%;width: 22%;float:left'class='btn btn-block btn-outline-primary btn-sm' data-toggle='modal' data-target='#modal-editI'onclick='editInterfaceClick(this);'>修改</button> "+
		        "<button id='deleteBtn' type='button' style='margin-left:3%;width: 22%;float:left'class='btn btn-block btn-outline-danger btn-sm'   onclick='deleteClick(this);'>删除</button> "+
		        "<button id='dataBtn' type='button' style='margin-left:3%;width: 24%;float:left'class='btn btn-block btn-outline-warning' onclick='toPara(this);'>报文数据</button> "+
		        "</td>";
		        body    += "</tr>";
			    $("#example1 tbody" ).append(body); 
				
			}

			$("#example1").DataTable({
			      "autoWidth": false,
			      "paging": true,
			      "lengthChange": true,
			      "searching": false,
			      "ordering": true,
			      "info": true,
			    });

		},
		error:function(result){
			alert("未知错误联系管理员！");
		}
	});

}

//查询硬件模块，构建下拉框
function QryModSelect(){
	$.ajax({
		url:"/qryModSelect.do",
		type:"POST",
		async:true,
		success:function(result){
			var obody="";
			for(var i=0;i<result.length;i++){
				obody +=  "<option value='"+result[i].mod_name+"'>"+result[i].mod_name +"</option>";
			}	
			$("#selectSource").append(obody);
			$("#selectSource").multiselect("destroy").multiselect({  
		    	nonSelectedText:"筛选条件/信源",
				buttonWidth: "200px",
				numberDisplayed:4,
				onDropdownHidden: function(event) {
					var source=$("#selectSource ").val();
					var destination=$("#selectDestination ").val();
					refreshDataBySelect(source,destination);
					
	            }
	          }); 
			
			$("#selectDestination").append(obody);
		    $("#selectDestination").multiselect("destroy").multiselect({  
		    	nonSelectedText:"筛选条件/信宿",
				buttonWidth: "200px",
				numberDisplayed:4,
				onDropdownHidden: function(event) {
					var source=$("#selectSource").val();
					var destination=$("#selectDestination").val();
					refreshDataBySelect(source,destination);
	            }
	          }); 
		    $('.dropdown-toggle').dropdown();
		},
		error:function(result){
			alert("未知错误联系管理员！");
		}
	});
}

//根据下拉框更新当前页面内容
function refreshDataBySelect(source,destination){
	$.ajax({
		url:"/qryMesBySelect.do",
		type:"POST",
		async:true,
		data:{"mesType":mesType,
			"source":source.toString(),
			"destination":destination.toString()},
		success:function(result){
			var oldTable = $('#example1').dataTable();
		    oldTable.fnClearTable(); 
		    oldTable.fnDestroy();
			var body="";
			for(var i=0;i<result.length;i++){
				body = "<tr>";
				body    += "<td id='timesId'>" + result[i].mesId + "</td>";
		        body    += "<td id='tmesName'>" + result[i].mesName + "</td>";
		        body    += "<td id='tmesSource'>" + result[i].mesSource + "</td>";  
		        body    += "<td id='tmesDestination'>" + result[i].mesDestination + "</td>";
		        body    += "<td>"+
		        "<button id='detailBtn' type='button' style='width:23%;margin-top:6px;float:left;'class='btn btn-block btn-outline-success btn-sm' data-toggle='modal' data-target='#modal-detail'onclick='showDetail(this)'>报文详情</button> "+
		        "<button id='editIBtn' type='button' style='margin-left:3%;width: 22%;float:left'class='btn btn-block btn-outline-primary btn-sm' data-toggle='modal' data-target='#modal-editI'onclick='editInterfaceClick(this);'>修改</button> "+
		        "<button id='deleteBtn' type='button' style='margin-left:3%;width: 22%;float:left'class='btn btn-block btn-outline-danger btn-sm'   onclick='deleteClick(this);'>删除</button> "+
		        "<button id='dataBtn' type='button' style='margin-left:3%;width: 24%;float:left'class='btn btn-block btn-outline-warning' onclick='toPara(this);'>报文数据</button> "+
		        "</td>";
		        body    += "</tr>";
			    $("#example1 tbody" ).append(body); 
				
			}

			$("#example1").DataTable({
			      "autoWidth": false,
			      "paging": true,
			      "lengthChange": true,
			      "searching": false,
			      "ordering": true,
			      "info": true,
			    });

		},
		error:function(result){
			alert("未知错误联系管理员！");
		}
	});
	
}

</script>    

<script type="text/javascript">
	QryMessage();
	QryModSelect();
	$(function () {
		$('#selectSource').multiselect({
			nonSelectedText:"筛选条件/信源",
			buttonWidth: "200px",
			numberDisplayed:4,	
			
	}); 
		$('#selectDestination').multiselect({
			nonSelectedText:"筛选条件/信宿",
			buttonWidth: "200px",
			numberDisplayed:4,
			
		}); 
		 $('.dropdown-toggle').dropdown();
	})
</script>

</body>
</html>
