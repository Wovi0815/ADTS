<!DOCTYPE html>
<html lang="en" xmlns="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>主页</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" th:href="@{/plugins/fontawesome-free/css/all.min.css}">
    <!-- Ionicons -->
    <link rel="stylesheet" th:href="@{/dist/css/ionicons.css}">
    <!-- Tempusdominus Bbootstrap 4 -->
    <link rel="stylesheet" th:href="@{/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css}">
    <!-- iCheck -->
    <link rel="stylesheet" th:href="@{/plugins/icheck-bootstrap/icheck-bootstrap.min.css}">
    <!-- JQVMap -->
    <link rel="stylesheet" th:href="@{/plugins/jqvmap/jqvmap.min.css}">
    <!-- Theme style -->
    <link rel="stylesheet" th:href="@{/dist/css/adminlte.min.css}">
    <!-- overlayScrollbars -->
    <link rel="stylesheet" th:href="@{/plugins/overlayScrollbars/css/OverlayScrollbars.min.css}">
    <!-- Daterange picker -->
    <link rel="stylesheet" th:href="@{/plugins/daterangepicker/daterangepicker.css}">
    <!-- summernote -->
    <link rel="stylesheet" th:href="@{/plugins/summernote/summernote-bs4.css}">

    <style>
        #structData {
            width: 90%;
            margin-left: 5%;
            position: relative;
            top: 5%;
        }
        
        .ctr button {
            float: left;
            margin-top: 8px;
            margin-left: 5px;
        }
        
        #up {
            width: 20%;
        }
        
        #down {
            width: 20%;
        }
        
        #del {
            width: 50%
        }
        
        #data .input-group {
            width: 90%;
        }
    </style>
</head>

<body class="hold-transition sidebar-mini layout-fixed">

    <table id="data" frame=void style="width: 90%; margin-left: 5%;margin-bottom: 2%;margin-top: 2%;">
        <tbody>
            <tr>

                <td>
                    <div class="input-group">
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-default">类型标识</button>
                        </div>
                        <!-- /btn-group -->
                        <input id="typId" type="text" class="form-control">
                    </div>
                </td>

                <td>
                    <div class="input-group">
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-default">类型名称</button>
                        </div>
                        <!-- /btn-group -->
                        <input id="typName" type="text" class="form-control">
                    </div>
                </td>

                <td>
                    <div class="input-group">
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-default">类型大小</button>
                        </div>
                        <!-- /btn-group -->
                        <input id="typSize" type="text" class="form-control">
                    </div>
                </td>

                <td>
                    <div class="input-group">
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-default">类型描述</button>
                        </div>
                        <!-- /btn-group -->
                        <input id="typDesc" type="text" class="form-control">
                    </div>
                </td>

            </tr>
        </tbody>
    </table>

    <table id="structData" class="table table-bordered table-hover">
        <thead>
            <tr>
                <th>顺序</th>
                <th>成员标识</th>
                <th>成员名称</th>
                <th>成员类型</th>
                <th>物理量纲</th>
                <th>最大值</th>
                <th>最小值</th>
                <th>默认值</th>
                <th>描述</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody id="structMem">

        </tbody>
        <tfoot>
            <tr>
                <td id="addRow" style="text-align: center;" colspan="9">
                    ➕
                </td>
            </tr>
        </tfoot>
    </table>
    <button id='cancel' type='button' style='margin-right:3% ;width: 10%;float: right;margin-bottom: 1%;
    margin-top: 2%;' class='btn btn-block btn-outline-info btn-sm' onclick='cancel();'>取消</button>
    <button id='save' type='button' style='margin-right:3% ;width: 10%;float: right;margin-bottom: 2%;
    margin-top: 2%;' class='btn btn-block btn-outline-info btn-sm' onclick='save();'>保存</button>
</body>
<script th:src="@{/plugins/jquery/jquery.js}"></script>
<script th:src="@{/plugins/bootstrap/js/bootstrap.min.js}"></script>
<script type="module" th:src="@{/plugins/popper/popper.js}"></script>
<!-- jQuery -->
<script th:src="@{/plugins/jquery/jquery.min.js}"></script>
<!-- jQuery UI 1.11.4 -->
<script th:src="@{/plugins/jquery-ui/jquery-ui.min.js}"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
    $.widget.bridge('uibutton', $.ui.button)
</script>
<!-- Bootstrap 4 -->
<script th:src="@{/plugins/select2/js/select2.full.min.js}"></script>
<script th:src="@{/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js}"></script>
<script th:src="@{/plugins/bootstrap-switch/js/bootstrap-switch.min.js}"></script>
<script th:src="@{/plugins/bootstrap/js/bootstrap.min.js}"></script>
<!-- DataTables -->
<script th:src="@{/plugins/datatables/jquery.dataTables.min.js}"></script>
<script th:src="@{/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js}"></script>
<script th:src="@{/plugins/datatables-responsive/js/dataTables.responsive.min.js}"></script>
<script th:src="@{/plugins/datatables-responsive/js/responsive.bootstrap4.min.js}"></script>

<!-- ChartJS -->

<!-- Sparkline -->
<script th:src="@{/plugins/chart.js/Chart.min.js}"></script>
<script th:src="@{/plugins/sparklines/sparkline.js}"></script>

<!-- jQuery Knob Chart -->
<script th:src="@{/plugins/jquery-knob/jquery.knob.min.js}"></script>
<!-- overlayScrollbars -->
<script th:src="@{/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js}"></script>
<!-- AdminLTE App -->
<script th:src="@{/dist/js/adminlte.js}"></script>

<script>
    var count = 1;
    var mod = " ";
    var structId;
    $(function() {
        search();
    });

    function save() {
        var typId = $("#typId").val();
        var typName = $("#typName").val();
        var typSize = $("#typSize").val();
        var typDesc = $("#typDesc").val();
        if (typId == null || typId.trim() == "") {
            alert("类型标识不能为空！！");
            return;
        }
        if (typName == null || typName.trim() == "") {
            alert("类型标识不能为空！！");
            return;
        }
        if (typSize == null || typSize.trim() == "") {
            alert("类型标识不能为空！！");
            return;
        }
        if (typDesc == null || typDesc.trim() == "") {
            alert("类型标识不能为空！！");
            return;
        }
        var trList = $("#structMem").children("tr");
        var memList = new Array();
        for (var i = 0; i < trList.length; i++) {
            var mem = new Map();
            var tdArr = trList.eq(i).find("td");
            var memNo = tdArr.eq(0).text();
            var memId = tdArr.eq(1).text();
            var memName = tdArr.eq(2).text();
            var memType = tdArr.eq(3).text();
            var memPhyDim = tdArr.eq(4).text();
            var memMax = tdArr.eq(5).text();
            var memMin = tdArr.eq(6).text();
            var memDefault = tdArr.eq(7).text();
            var memDesc = tdArr.eq(8).text();
            // mem.push("memNo", memNo);
            // mem.set("memId", memId);
            // mem.set("memName", memName);
            // mem.set("memType", memType);
            // mem.set("memPhyDim", memPhyDim);
            // mem.set("memMax", memMax);
            // mem.set("memMin", memMin);
            // mem.set("memDefault", memDefault);
            // mem.set("memDesc", memDesc);
            memList.push({
                memNo: memNo,
                memId: memId,
                memName: memName,
                memType: memType,
                memPhyDim: memPhyDim,
                memMax: memMax,
                memMin: memMin,
                memDefault: memDefault,
                memDesc: memDesc
            });
        }
        console.log(memList);
        $.ajax({
            data: {
                "typId": typId,
                "typName": typName,
                "typSize": typSize,
                "typDesc": typDesc,
                "memList": JSON.stringify(memList)
            },
            url: "/addStructData",
            type: "POST",
            async: true,
            success: function(result) {

            },
            error: function() {
                alert("未知错误！！请联系管理员！！！");
            }
        });



    }

    function clear() {

    }

    function search() {

    }

    function edit(e) {

    }

    function del(e) {
        $(e).parent().parent().remove();

        refresh();

    }

    function add() {

    }

    function cancel() {
        window.parent.zhu.location.href = "/dataTypeManager";
    }

    $("#addRow").click(function() {
        $("#structMem").append(
            "<tr><td class='order'>" + "</td>" +
            "<td contentEditable='true'></td>" +
            "<td contentEditable='true'></td>" +
            "<td contentEditable='true'></td>" +
            "<td contentEditable='true'></td>" +
            "<td contentEditable='true'></td>" +
            "<td contentEditable='true'></td>" +
            "<td contentEditable='true'></td>" +
            "<td contentEditable='true'></td>" +
            "<td class='ctr'>" +
            "<button id='up' class='btn btn-block btn-outline-info btn-sm' onclick='up(this);'>⏫</button>" +
            "<button id='down' class='btn btn-block btn-outline-info btn-sm' onclick='down(this);'>⏬</button>" +
            "<button id='del' class='btn btn-block btn-outline-info btn-sm' onclick='del(this);'>删除</button>" +
            "</td></tr>"
        );
        refresh();
    });

    function up(e) {
        console.log($(e).parent().parent().prev());
        $(e).parent().parent().prev().before(
            "<tr>" +
            $(e).parent().parent().html() +
            "</tr>"
        );
        $(e).parent().parent().remove();
        refresh();
    }

    function down(e) {

        console.log($(e).parent().parent().next());
        $(e).parent().parent().next().after(
            "<tr>" +
            $(e).parent().parent().html() +
            "</tr>"
        );
        $(e).parent().parent().remove();
        refresh();

    }

    function refresh() {
        $("#structMem #up").show();
        $("#structMem #down").show();
        $("#structMem #up").first().hide();
        $("#structMem #down").last().hide();
        var i = 1;
        $("#structMem").find("tr").each(function() {
            console.log($(this).children("td:first").text(i));
            i++;
        });
    }
</script>

</html>