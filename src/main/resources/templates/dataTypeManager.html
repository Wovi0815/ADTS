<!DOCTYPE html>
<html lang="en" xmlns="http://www.thymeleaf.org">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Font Awesome -->
    <link rel="stylesheet" th:href="@{/plugins/fontawesome-free/css/all.min.css}">
    <!-- Ionicons -->
    <link rel="stylesheet" th:href="@{/dist/css/ionicons.css}">
    <!-- Tempusdominus Bbootstrap 4 -->
    <link rel="stylesheet" th:href="@{/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css}">
    <!-- iCheck -->
    <link rel="stylesheet" th:href="@{/plugins/icheck-bootstrap/icheck-bootstrap.min.css}">
    <!-- DataTables -->
    <link rel="stylesheet" th:href="@{/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css}">
    <link rel="stylesheet" th:href="@{/plugins/datatables-responsive/css/responsive.bootstrap4.min.css}">
    <!-- Theme style -->
    <link rel="stylesheet" th:href="@{/dist/css/adminlte.min.css}">
    <!-- overlayScrollbars -->
    <link rel="stylesheet" th:href="@{/plugins/overlayScrollbars/css/OverlayScrollbars.min.css}">
    <!-- bootstrap-multiselect -->
    <link rel="stylesheet" th:href="@{/plugins/bootstrap-multiselect/css/bootstrap-multiselect.css}">
    
	
    <style>
	
		input::-webkit-input-placeholder {
			/* WebKit browsers */
			font-size: 10px;
		}

		input:-moz-placeholder {
			/* Mozilla Firefox 4 to 18 */
			font-size: 10px;
		}

		input::-moz-placeholder {
			/* Mozilla Firefox 19+ */
			font-size: 10px;
		}

		input:-ms-input-placeholder {
			/* Internet Explorer 10+ */
			font-size: 10px;
		}
        
        .m-toast-pop {
            display: none;
            position: fixed;
            width: 100%;
            top: 0;
            bottom: 0;
            right: 0;
            overflow: auto;
            text-align: center;
        }
        
        .m-toast-inner {
            position: absolute;
            left: 50%;
            top: 50%;
            width: 100%;
            transform: translate(-50%, -50%);
            -webkit-transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .m-toast-inner-text {
            display: inline-block;
            margin: 0 22px;
            padding: 19px 21px;
            font-size: 16px;
            color: #FFFFFF;
            letter-spacing: 0;
            line-height: 22px;
            background: rgba(0, 0, 0, 0.72);
            border-radius: 10px;
        }
    </style>
</head>

<body class="hold-transition sidebar-mini layout-fixed">

    <div class="modal fade" id="modal-add-basic">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span></button>
                    <h4 id="title" class="modal-title"></h4>
                </div>
				<div class="modal-body">
					<!-- 模态框内容 -->
					<div class="form-group">
						<label for="typId">类型标识</label> <input class="form-control"
							placeholder="类型标识" id="typId">
					</div>

					<div class="form-group">
						<label for="typName">类型名称</label> <input class="form-control"
							placeholder="类型名称" id="typName">
					</div>
					<div class="form-group">
						<label for="typSize">长度</label> <input class="form-control"
							placeholder="长度" id="typSize">
					</div>
					<div class="form-group">
						<label for="typDesc">类型描述</label> <input class="form-control"
							placeholder="类型描述" id="typDesc">
					</div>

				</div>
				<div class="modal-footer justify-content-between">
					<button id='closeModal' type="button" class="btn btn-default"
						data-dismiss="modal" style="float: right; margin-left: 2%;">取消</button>
					<button id='saveModal' type="button" class="btn btn-primary"
						onclick="save();">保存</button>
				</div>

			</div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
			<!-- 结构体模态框 -->
	<div class="modal fade" id="modal-add-struct">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
		
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="false">&times;</span>
              </button>
            </div>
            <div class="modal-body" >
              	<!-- 模态框内容 -->
			  <div  id="addAreaX">
				<div class="form-group" >
					 <label for="structId">结构体标识</label>
					 <input class="form-control" placeholder="结构体标识" id="structId">
				</div>
				<div class="form-group">
					 <label for="structName">结构体名称</label>
					 <input class="form-control" placeholder="结构体名称" id="structName">
				</div>
				<div class="form-group">
					 <label for="structSize">结构体长度</label>
					 <input class="form-control" placeholder="结构体长度" id="structSize">
				</div>
				<div class="form-group">
					 <label for="structDesc">结构体描述</label>
					 <input class="form-control" placeholder="结构体描述" id="structDesc">
				</div>
			  </div>
				
			  <div id="addArea">
				
				
			  </div>
            </div>
            
            <div class="modal-footer justify-content-between" >
              <button id='structModalClose' type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
              <button id='structModalAddDate' type="button" class="btn btn-default" onclick="addRow();">➕</button>
              <button id='structModalSave' type="button"  class="btn btn-primary" onclick="structSave();">保存</button>
            </div>
          </div>
        </div>
      </div>


    <div class="card-body">
       <button id='addBtn1'type='button' class='btn btn-block btn-outline-info btn-sm' data-toggle="modal" data-target="#modal-add-basic" onclick="add();"style="margin-right:2% ;width: 10%;float: right;margin-top:0px;">新增数据类型</button>    
       <button id='addBtn2'type='button' class='btn btn-block btn-outline-info btn-sm' data-toggle="modal" data-target="#modal-add-struct" onclick="addStruct();"style="margin-right:2% ;width: 10%;float: right;margin-top:0px;">新增结构体</button>  
        <table id="typeData" class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>类型标识</th>
                    <th>类型名称</th>
                    <th>长度</th>
                    <th>属性</th>
                    <th>类型描述</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>


    <div id="m-toast-pop" class="m-toast-pop">
        <div class="m-toast-inner">
            <div class="m-toast-inner-text" id="m-toast-inner-text">复制成功</div>
        </div>
    </div>
</body>

<script th:src="@{/plugins/jquery/jquery.js}"></script>
<script type="module" th:src="@{/plugins/bootstrap/js/bootstrap.min.js}"></script>
<script type="module" th:src="@{/plugins/popper/esm/popper.js}"></script>
<script type="module" th:src="@{/plugins/popper/popper.js}"></script>
<script th:src="@{/plugins/popper/umd/popper.js}"></script>


<!-- jQuery -->
<script th:src="@{/plugins/jquery/jquery.min.js}"></script>
<!-- jQuery UI 1.11.4 -->
<script th:src="@{/plugins/jquery-ui/jquery-ui.min.js}"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
    $.widget.bridge('uibutton', $.ui.button)
</script>
<!-- Bootstrap 4 -->
<script th:src="@{/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js}"></script>
<script th:src="@{/plugins/bootstrap-switch/js/bootstrap-switch.min.js}"></script>
<script th:src="@{/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
<!-- DataTables -->
<script th:src="@{/plugins/datatables/jquery.dataTables.min.js}"></script>
<script th:src="@{/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js}"></script>
<script th:src="@{/plugins/datatables-responsive/js/dataTables.responsive.min.js}"></script>
<script th:src="@{/plugins/datatables-responsive/js/responsive.bootstrap4.min.js}"></script>

<!-- Sparkline -->
<script th:src="@{/plugins/chart.js/Chart.min.js}"></script>
<script th:src="@{/plugins/sparklines/sparkline.js}"></script>
<!-- bootstrap-multiselect -->
<script th:src="@{/plugins/bootstrap-multiselect/js/bootstrap-multiselect.js}"></script>
<!-- jQuery Knob Chart -->
<script th:src="@{/plugins/jquery-knob/jquery.knob.min.js}"></script>
<!-- overlayScrollbars -->
<script th:src="@{/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js}"></script>
<!-- AdminLTE App -->
<script th:src="@{/dist/js/adminlte.js}"></script>

<script>



//------全局变量-------
var i;
var clickKey;
//------全局变量-------
//##################普通数据类型##########################
function qryDataType() {
     $("#typeData tbody").empty();
     $.ajax({
         type: "POST",
         url: "/qryDataType",
         async: true,
         success: function(result) {
              for (var i = 0; i < result.length; i++) {
            	  body = "<tr>";
  				  body    += "<td id='tinterfaceId'>" + result[i].i_id + "</td>";
  		          body    += "<td id='tinterfaceName'>" + result[i].i_name + "</td>";
  		          body    += "<td id='tinterfaceReturn'>" + result[i].i_return + "</td>";  
  		          body    += "<td id='tinterfaceParaCount'>" + result[i].i_para_count + "</td>";
  		          body    += "<td id='tinterfaceParaType'>" + result[i].i_para_list + "</td>";
  		          body    += "<td>"+
  		          "<button id='detailBtn' type='button' style='margin-left: 2%;width: 30%;float: left;margin-top: 0px;'class='btn btn-block btn-outline-success btn-sm' data-toggle='modal' data-target='#modal-detail'onclick='showDetail(this)'>数据类型详情</button> "+
		          "<button id='editIBtn' type='button' style='margin-left: 3%;width: 30%;float: left;margin-top: 0px;'class='btn btn-block btn-outline-primary btn-sm' data-toggle='modal' data-target='#modal-default'onclick='editClick(this);'>修改</button> "+
		          "<button id='deleteBtn' type='button' style='margin-left: 3%;width: 30%;float: left;margin-top: 0px;'class='btn btn-block btn-outline-danger btn-sm'   onclick='deleteClick(this);'>删除</button> "+
		          "</td>";
  		          body    += "</tr>";
  			      $("#example1 tbody" ).append(body); 
              }
              var oldTable = $('#typeData').dataTable();
	   		  oldTable.fnClearTable(); 
	  		  oldTable.fnDestroy();
           $("#typeData").DataTable({
   				"autoWidth": false,
   			    "paging": true,
   			    "lengthChange": true,
   			    "searching": false,
   			    "ordering": true,
   			    "info": true,
   			  });
   
            },
            error: function() {
            	toastr.warning('未知错误,请联系管理员!');
            }
        });
    }
function add() {
	clickKey = "add";
        $("#typId").val("");
        $("#typName").val("");
        $("#typSize").val("");
        $("#typDesc").val("");
 }
function editClick(e) {
    clickKey = "edit";
    var typId = $(e).parent().parent().children().eq(0).text();
    $.ajax({
        url: "/detailBasicDataType",
        data: {
            "typId": typId
        },
        type: "POST",
        async: true,
        success: function(result) {
         
            $("#typId").attr("readOnly","true");
            $("#typId").val(result[0].typId);
            $("#typDesc").val(result[0].typDesc);
            $("#typName").val(result[0].typName);
            $("#typSize").val(result[0].typSize);
        }
    });
}








function save() {
      var typId = $("#typId").val();
      var typDesc = $("#typDesc").val();
      var typName = $("#typName").val();
      var typSize = $("#typSize").val();
      if (clickKey == "add") {
            $.ajax({
                type: "POST",
                url: "/saveBasicDataType",
                async: true,
                data: {
                    "typId": typId,
                    "typName": typName,
                    "typAttr": "basic",
                    "typSize": typSize,
                    "typDesc": typDesc
                },
                success: function(result) {
                    if (result == 0) {
                        alert("该类型已存在！");
                        return;
                    }
                    $("#modal-add-basic").modal('hide');
                    search();
                    $('#m-toast-inner-text').text('保存成功');
                    $('#m-toast-pop').fadeIn();
                    $('#m-toast-pop').fadeOut();


                },
                error: function() {
                    console.log("保存错误！请联系管理员！！")
                }
            });
        } else if (clickKey == "edit") {
            $.ajax({
                type: "POST",
                url: "/updateBasicDataType",
                async: true,
                data: {
                    "typId": typId,
                    "typName": typName,
                    "typAttr": "basic",
                    "typSize": typSize,
                    "typDesc": typDesc
                },
                success: function(result) {
                    search();
                    $("#modal-add-basic").modal('hide');

                    $('#m-toast-inner-text').text('保存成功');
                    $('#m-toast-pop').fadeIn();
                    setTimeout(function() {
                        $('#m-toast-pop').fadeOut();

                    }, 200);
                },
                error: function() {
                    console.log("保存错误！请联系管理员！！")
                }
            });
        }
    }




   

    function del(e) {
        var typId = $(e).parent().parent().children().eq(0).text();
        $.ajax({
            url: "/delBasicDataType",
            data: {
                "typId": typId
            },
            type: "POST",
            async: true,
            success: function(result) {
                search();
                $('#m-toast-inner-text').text('删除成功');
                $('#m-toast-pop').fadeIn();
                setTimeout(function() {
                    $('#m-toast-pop').fadeOut();
                }, 200);
            }
        });
    }



    function addStruct(){
    	$("#structModalClose").attr({"disabled":"true"});
    	$("#structModalSave").attr({"disabled":"true"});
    	i=1;

    }
    function addRow(){
    	var ibody="";
		ibody += "<div class='input-group' id ='inputGroup"+i+"' >";
		ibody += "<input style='width:3%;font-size:12px;' readonly='readonly' placeholder='次序' value='"+i+"' id='memNo"+i+"'/>";
		ibody += "<input class='form-control' placeholder='成员标识'id='memId"+i+"'>";
		ibody += "<input class='form-control' placeholder='成员名称'id='memName"+i+"'>";
		ibody += "<input class='form-control' placeholder='成员类型'id='memType"+i+"'>";
		ibody += "<input class='form-control' placeholder='成员描述'id='memDesc"+i+"'>";
		ibody += "<input class='form-control' placeholder='物理量纲'id='memPhy"+i+"'>";
		ibody += "<input class='form-control' type='number' placeholder='最大值'id='memMax"+i+"'>";
		ibody += "<input class='form-control' type='number' placeholder='最小值'id='memMin"+i+"'>";
		ibody += "<input class='form-control' type='number' placeholder='默认值'id='memDefault"+i+"'>";
		ibody += "<button id='buttonUp"+i+"'onclick='goUp(this);' >⏫</button>";
		ibody += "<button id='buttonDown"+i+"'onclick='goDown(this);' >⏬</button>";
		ibody += "</div>";
		$("#addArea").append(ibody);
    	
    	$("#structModalClose").removeAttr("disabled");
    	$("#structModalSave").removeAttr("disabled");
			i++;
    }
    
    

    function editStruct(e) {

        var typId = $(e).parent().parent().children().eq(0).text();
        console.log(typId);
        window.parent.zhu.location.href = "/addStruct?mod=edit&typId=" + typId;
    }

    function delStruct() {
        var typId = $(e).parent().parent().children().eq(0).text();
        console.log(typId);
    }

    function detailStruct(e) {
        var typId = $(e).parent().parent().children().eq(0).text();
        window.parent.zhu.location.href = "/detailStruct?typId=" + typId;
    }
</script>

</html>