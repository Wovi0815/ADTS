<html lang="en" xmlns="http://www.thymeleaf.org">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<!-- Font Awesome -->
	 	<link rel="stylesheet" th:href="@{/plugins/fontawesome-free/css/all.min.css}"> 
		<!-- Ionicons -->
		<link rel="stylesheet" th:href="@{/dist/css/ionicons.css}">
		<!-- iCheck -->
		<link rel="stylesheet" th:href="@{/plugins/icheck-bootstrap/icheck-bootstrap.min.css}">
		<!-- DataTables -->
  		<link rel="stylesheet" th:href="@{/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css}">
  		<link rel="stylesheet" th:href="@{/plugins/datatables-responsive/css/responsive.bootstrap4.min.css}">
		<!-- Theme style -->
		<link rel="stylesheet" th:href="@{/dist/css/adminlte.min.css}">
		<!-- overlayScrollbars -->
		<link rel="stylesheet" th:href="@{/plugins/overlayScrollbars/css/OverlayScrollbars.min.css}">	
		<!-- bootstrap-multiselect -->
		<link rel="stylesheet" th:href="@{/plugins/bootstrap-multiselect/css/bootstrap-multiselect.css}" >
		<!-- toastr -->
		<link rel="stylesheet" th:href="@{/plugins/toastr/toastr.min.css}">
		
		<title>接口页</title>
		<style type="text/css">
		input::-webkit-input-placeholder {
			/* WebKit browsers */
			font-size: 10px;
		}

		input:-moz-placeholder {
			/* Mozilla Firefox 4 to 18 */
			font-size: 10px;
		}

		input::-moz-placeholder {
			/* Mozilla Firefox 19+ */
			font-size: 10px;
		}

		input:-ms-input-placeholder {
			/* Internet Explorer 10+ */
			font-size: 10px;
		}
	</style>
		
	
	</head>
	<body>
	<!-- 接口详情模态框 -->
	<div class="modal fade" id="modal-detail">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title" id="modalTitle"></h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              	<!-- 模态框内容 -->
			<div class="form-group" id="descArea">
			
			</div>
			
			<div class="form-group" id="paraArea">
			
			</div>
			
            </div>
            
          </div>
        </div>
      </div>
      
      
      
      <!-- 新增页面模态框 -->
	<div class="modal fade" id="modal-add">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
				 <div class='form-group' > 
				 	<div class='input-group-prepend' style="float:left;">
				 		<span class='input-group-text' >参数数量</span>
				 	 <input class='form-control'oninput='value=value.replace(/[^\d]/g,"")' placeholder='请输入接口的参数数量' id='iparaCount'/>
	            	</div>
	            	<div class='input-group-prepend'style="float:left;margin-left:5px">
				 		<span class='input-group-text' >参数类型</span>
				 	 <input class='form-control' placeholder='参数类型,以【,】分隔' id='iparalist'/>
	            	</div>
	            	
	             </div>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="false">&times;</span>
              </button>
            </div>
            <div class="modal-body" >
              	<!-- 模态框内容 -->
				<div id="addArea">
				</div>
				<div  id="addAreaX">
				<div class="form-group" >
					 <label for="iinterfaceId">接口标识</label>
					 <input class="form-control" placeholder="接口标识" id="iinterfaceId">
				</div>
				<div class="form-group">
					 <label for="iinterfaceName">接口名称</label>
					 <input class="form-control" placeholder="接口名称" id="iinterfaceName">
				</div>
				<div class="form-group">
					 <label for="iinterfaceDesc">接口描述</label>
					 <input class="form-control" placeholder="接口描述" id="iinterfaceDesc">
				</div>
				<div class="form-group">
					 <label for="iinterfaceRemark">接口备注</label>
					 <input class="form-control" placeholder="接口备注" id="iinterfaceRemark">
				</div>
				<div class="form-group">
					 <label for="iinterfaceRetnTyp">返回值类型</label>
					 <input class="form-control" placeholder="返回值类型" id="iinterfaceRetnTyp"  >
				</div>
				<div class="form-group">
					 <label for="iinterfaceRetnDesc">返回值描述</label>
					 <input class="form-control" placeholder="返回值描述" id="iinterfaceRetnDesc" >
				</div>
				<div class="form-group">
					 <label for="iinterfaceCls">归属类</label>
					 <input class="form-control" placeholder="归属类" id="iinterfaceCls"  readonly='readonly'>
				</div>
				</div>
            </div>
            
            <div class="modal-footer justify-content-between">
              <button id='closeaddModal' type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
              <button id='saveaddModal' type="button"  class="btn btn-primary" onclick="addSave();">保存</button>
            </div>
          </div>
        </div>
      </div>
	
	
	   <!-- 修改接口页面模态框 -->
	<div class="modal fade" id="modal-editI">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header" >
              
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              	<!-- 模态框内容 -->
			<div class="form-group" >
				
				<div class="form-group" >
					 <label for="einterfaceId">接口标识</label>
					 <input class="form-control" placeholder="接口标识" id="einterfaceId" readonly='readonly'>
				</div>
				<div class="form-group">
					 <label for="einterfaceName">接口名称</label>
					 <input class="form-control" placeholder="接口名称" id="einterfaceName">
				</div>
				<div class="form-group">
					 <label for="einterfaceDesc">接口描述</label>
					 <input class="form-control" placeholder="接口描述" id="einterfaceDesc">
				</div>
				<div class="form-group">
					 <label for="einterfaceRemark">接口备注</label>
					 <input class="form-control" placeholder="接口备注" id="einterfaceRemark">
				</div>
				<div class="form-group">
					 <label for="einterfaceRetnTyp">返回值类型</label>
					 <input class="form-control" placeholder="返回值类型" id="einterfaceRetnTyp"  >
				</div>
				<div class="form-group">
					 <label for="einterfaceRetnDesc">返回值描述</label>
					 <input class="form-control" placeholder="返回值描述" id="einterfaceRetnDesc" >
				</div>
				<div class="form-group">
					 <label for="einterfaceCls">归属类</label>
					 <input class="form-control" placeholder="归属类" id="einterfaceCls"  readonly='readonly'>
				</div>
				
            </div>

			</div>
			
            
			<div class="modal-footer justify-content-between" id="editModalBtnArea">
			   <button id='closeEditModal' type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
			   <button id='saveEditModal' type="button"  class="btn btn-primary" data-dismiss="modal" onclick="editInterfaceSave();">保存</button>
			</div>
			
			
          </div>
        </div>
      </div>
	
	
	

	
		<!-- 表格相关 -->   
            <div class="card-body">    
             <button id='addBtn'type='button' style='margin-right:2% ;width: 8%;float: right;' class='btn btn-block btn-outline-info btn-sm' data-toggle='modal' data-target='#modal-add' onclick='addClick();'>新增接口</button> 
			<div id="select">        
 		      <select class="form-control select2bs4"   style="margin-right:5%;width:15%;float:right;" id="selectReturn">
		      </select> 
		      <select class="form-control select2bs4"   style="margin-right:3%;width:15%;float:right;" id="selectCount">
		      </select>
       		</div>
       
              <table id="example1" class="table table-bordered table-striped">
                <thead>
                <tr>
                  <th>接口标识</th>
                  <th>接口名称</th>
                  <th>返回值类型</th>
                  <th>参数个数</th>
                  <th>参数类型</th>
                  <th>操作</th>
                </tr>
                </thead>
                <tbody >
                </tbody>
              </table>
         </div>
         

	<!-- jQuery -->
	<script th:src="@{/plugins/jquery/jquery.min.js}"></script>
	<!-- 多选start-->
	<!-- popper -->
	<script type="module"th:src="@{/plugins/popper/esm/popper.js}"></script>
	<script type="module"th:src="@{/plugins/popper/popper.js}"></script>
	<script th:src="@{/plugins/popper/umd/popper.js}"></script>
	<!-- Bootstrap 4 适应popper-->
	<script th:src="@{/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
	<!-- bootstrap-multiselect -->
	<script  th:src="@{/plugins/bootstrap-multiselect/js/bootstrap-multiselect.js}"></script>
	<!-- 多选end-->
	<!-- DataTables -->
	<script th:src="@{/plugins/datatables/jquery.dataTables.min.js}"></script>
	<script th:src="@{/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js}"></script>
	<script th:src="@{/plugins/datatables-responsive/js/dataTables.responsive.min.js}"></script>
	<!-- overlayScrollbars -->
	<script th:src="@{/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js}"></script>
	<!-- AdminLTE App -->
	<script th:src="@{/dist/js/adminlte.js}"></script>
	<!-- toastr -->
	<script th:src="@{/plugins/toastr/toastr.min.js}"></script>
	 
	<!-- page script -->
<script type="text/javascript">

function GetRequest() {
var url = location.search; //获取url中"?"符后的字串
var theRequest = new Object();
 if (url.indexOf("?") != -1) {
       var str = url.substr(1);
       strs = str.split("&");
       for (var i = 0; i < strs.length; i++) {
           theRequest[strs[i].split("=")[0]] = decodeURIComponent(strs[i].split("=")[1]);
       }
   }
   return theRequest;
}

//------全局变量-------
var a=GetRequest();//中间件菜单传值
var classId=a['classId'];
var selectCount ;
var selectReturn ;
var interfaceId;
var interfaceParaCount;
var interfaceParaList;

//------全局变量-------

function QryClsInterface(){//查类下属接口
	$("#example1 tbody" ).empty();
	$.ajax({
		url:"/QryClsInterface",
		type:"POST",
		async:true,
		data:{"classId":classId},
		success:function(result){
			var body="";
			for(var i=0;i<result.length;i++){
				body = "<tr>";
				body    += "<td id='tinterfaceId'>" + result[i].i_id + "</td>";
		        body    += "<td id='tinterfaceName'>" + result[i].i_name + "</td>";
		        body    += "<td id='tinterfaceReturn'>" + result[i].i_return + "</td>";  
		        body    += "<td id='tinterfaceParaCount'>" + result[i].i_para_count + "</td>";
		        body    += "<td id='tinterfaceParaType'>" + result[i].i_para_list + "</td>";
		        body    += "<td>"+
		        "<button id='detailBtn' type='button' style='margin-left: 1%;width: 24%;float: left;margin-top: 0px;'class='btn btn-block btn-outline-success btn-sm' data-toggle='modal' data-target='#modal-detail'onclick='showDetail(this)'>接口详情</button> "+
		        "<button id='editIBtn' type='button' style='margin-left: 3%;width: 20%;float: left;margin-top: 0px;'class='btn btn-block btn-outline-primary btn-sm' data-toggle='modal' data-target='#modal-editI'onclick='editInterfaceClick(this);'>修改</button> "+
		        "<button id='deleteBtn' type='button' style='margin-left: 3%;width: 20%;float: left;margin-top: 0px;'class='btn btn-block btn-outline-danger btn-sm'   onclick='deleteClick(this);'>删除</button> "+
		        "<button id='paraBtn' type='button' style='margin-left: 3%;width: 24%;float: left;margin-top: 0px;'class='btn btn-block btn-outline-warning btn-sm' onclick='toPara(this);'>参数操作</button> "+
		        "</td>";
		        body    += "</tr>";
			    $("#example1 tbody" ).append(body); 
				
			}
			
	
			$("#example1").DataTable({
			      
			      "autoWidth": false,
			      "paging": true,
			      "lengthChange": true,
			      "searching": false,
			      "ordering": true,
			      "info": true,
			    });

		},
		error:function(result){
			toastr.warning('未知错误,请联系管理员!');
		}
	});

}

function QryInterParaCount(){//查类下属接口参数数量，构建下拉框
	$("#selectCount").empty();
	$.ajax({
		url:"/QryInterParaCount",
		type:"POST",
		async:true,
		data:{"classId":classId},
		success:function(result){
			var obody="<option>筛选条件/参数个数</option>";
			for(var i=0;i<result.length;i++){
	        	obody	+= "<option id='opitem'>"+result[i].i_para_count +"</option>";
				}
			$("#selectCount" ).append(obody);
		},
		error:function(result){
			toastr.warning('未知错误,请联系管理员!');
		}
	});	
}
function QryInterReturnType(){//查类下属接口返回值类型，构建下拉框
	$("#selectReturn").empty();
	$.ajax({
		url:"/QryInterReturnType",
		type:"POST",
		async:true,
		data:{"classId":classId},
		success:function(result){
			var obody="<option>筛选条件/返回值类型</option>";
			for(var i=0;i<result.length;i++){
	        	obody	+= "<option id='opitem'>"+result[i].i_return +"</option>";
				}
			$("#selectReturn" ).append(obody);
		},
		error:function(result){
			toastr.warning('未知错误,请联系管理员!');
		}
	});	
}


//根据下拉框重新刷新表格
$("#select").change(function(){
	selectReturn =$("#selectReturn").val();	
	selectCount =$("#selectCount").val();	
	if(selectReturn=="筛选条件/返回值类型"){
		selectReturn=null;
	}
	if(selectCount=="筛选条件/参数个数"){
		selectCount=null;
	}
	var oldTable = $('#example1').dataTable();
    oldTable.fnClearTable(); 
    oldTable.fnDestroy();
	
	
	$.ajax({
		url:"/QryInterfaceBySelect",
		type:"POST",
		async:true,
		data:{
			"selectReturn":selectReturn,
			"selectCount":selectCount,
			"classId":classId
			},
		success:function(result){
			for(var i=0;i<result.length;i++){
				body = "<tr>";
				body    += "<td id='tinterfaceId'>" + result[i].i_id + "</td>";
		        body    += "<td id='tinterfaceName'>" + result[i].i_name + "</td>";
		        body    += "<td id='tinterfaceReturn'>" + result[i].i_return + "</td>";  
		        body    += "<td id='tinterfaceParaCount'>" + result[i].i_para_count + "</td>";
		        body    += "<td id='tinterfaceParaType'>" + result[i].i_para_list + "</td>";
		        body    += "<td>"+
		        "<button id='detailBtn' type='button' style='margin-left: 1%;width: 24%;float: left;margin-top: 0px;'class='btn btn-block btn-outline-success btn-sm' data-toggle='modal' data-target='#modal-detail'onclick='showDetail(this)'>接口详情</button> "+
		        "<button id='editIBtn' type='button' style='margin-left: 3%;width: 20%;float: left;margin-top: 0px;'class='btn btn-block btn-outline-primary btn-sm' data-toggle='modal' data-target='#modal-editI'onclick='editInterfaceClick(this);'>修改</button> "+
		        "<button id='deleteBtn' type='button' style='margin-left: 3%;width: 20%;float: left;margin-top: 0px;'class='btn btn-block btn-outline-danger btn-sm'   onclick='deleteClick(this);'>删除</button> "+
		        "<button id='paraBtn' type='button' style='margin-left: 3%;width: 24%;float: left;margin-top: 0px;'class='btn btn-block btn-outline-warning btn-sm' onclick='toPara(this);'>参数操作</button> "+
		        "</td>";
		        body    += "</tr>";
			    $("#example1 tbody" ).append(body); 
				
			}
			$("#example1").DataTable({
			      
			      "autoWidth": false,
			      "paging": true,
			      "lengthChange": true,
			      "searching": false,
			      "ordering": true,
			      "info": true,
			    });
		},	
			error:function(result){
				toastr.warning('未知错误,请联系管理员!');
		}
	});	

})


function showDetail(e){
	$("#descArea").empty();
	 interfaceId=$(e).parent().parent().find("td").eq(0).text();
	 interfaceParaCount=$(e).parent().parent().find("td").eq(3).text();
	 interfaceParaList=$(e).parent().parent().find("td").eq(4).text();
			
	 $.ajax({
			url:"/QryInterfaceDetail",
			type:"POST",
			async:true,
			data:{
				"interfaceId":interfaceId,
				"interfaceParaCount":interfaceParaCount,
				"interfaceParaList":interfaceParaList
			},
			success:function(result){
				var interfaceRemark = result.i_remark;
				var interfaceDesc = result.i_desc;
				var interfaceRetnDesc =result.i_return_desc;
				var modifyUser = result.modify_user;
				var updateTime = result.update_time;
				var createTime = result.create_time;
				var ibody="";
			   	ibody +="<div class='input-group'>";
				ibody += 	"<div class='input-group-prepend'>";
				ibody +=		 "<span class='input-group-text' >接口描述</span>";
				ibody +=	 "</div>" ;
				ibody +=	 "<input type='text'   class='form-control' value='"+interfaceDesc+"'readonly='readonly'/>";
				ibody +="</div>";
				ibody +="<div class='input-group'>";
				ibody += 	"<div class='input-group-prepend'>";
				ibody +=		 "<span class='input-group-text' >返回值描述</span>";
				ibody +=	 "</div>" ;
				ibody +=	 "<input type='text'   class='form-control' value='"+interfaceRetnDesc+"'readonly='readonly'/>";
				ibody +="</div>";
				ibody +="<div class='input-group'>";
				ibody += 	"<div class='input-group-prepend'>";
				ibody +=	 	"<span class='input-group-text' >接口备注</span>";
				ibody +=   "</div>";
				ibody += 	"<input type='text'    class='form-control' value='"+interfaceRemark+"'readonly='readonly'/>";
				ibody +="</div>";
				ibody +="<div class='input-group'>";
				ibody += 	"<div class='input-group-prepend'>";
				ibody +=	 	"<span class='input-group-text' >维护人</span>";
				ibody +=   "</div>";
				ibody += 	"<input type='text'    class='form-control' value='"+modifyUser+"'readonly='readonly'/>";
				ibody +="</div>";
				ibody +="<div class='input-group'>";
				ibody += 	"<div class='input-group-prepend'>";
				ibody +=	 	"<span class='input-group-text' >创建时间</span>";
				ibody +=   "</div>";
				ibody += 	"<input type='text'    class='form-control' value='"+createTime+"'readonly='readonly'/>";
				ibody +="</div>";
				ibody +="<div class='input-group'>";
				ibody += 	"<div class='input-group-prepend'>";
				ibody +=	 	"<span class='input-group-text' >修改时间</span>";
				ibody +=   "</div>";
				ibody += 	"<input type='text'    class='form-control' value='"+updateTime+"'readonly='readonly'/>";
				ibody +="</div>";
				
				$("#descArea").append(ibody);
				//查参数的信息
				qryInterfaceParaDetail(interfaceId,interfaceParaCount,interfaceParaList);
				
			},	
			error:function(result){
				toastr.warning('未知错误,请联系管理员!');
			}
		});	
	 
		
}

//新增 接口
function addClick(){
	$("#iparaCount").val("");
	$("#addArea").empty();
	$("#addAreaX input").each(function() {
		$(this).val("");
	})
	$("#iparalist").val("");
	$("#iinterfaceCls").val("");
	$("#iinterfaceCls").val(classId);
	$("#iparaCount").change(function(){	
		var iparaCount=$("#iparaCount").val();
		$("#addArea").empty();
		$("#iparalist").val("");
		if(iparaCount==0){$("#iparalist").val("无");}
		for(var i=1;i<=iparaCount;i++){
			var ibody="";
			ibody += "<div class='input-group' id ='inputGroup"+i+"' >";
			ibody += "<select class='form-control select2bs4' style='font-size:12px;' id='paraAttr"+i+"'><option>输入</option><option>输出</option></select> ";
			ibody += "<input style='width:3%;font-size:12px;' readonly='readonly' placeholder='参数次序' value='"+i+"' id='paraNo"+i+"'/>";
			ibody += "<input class='form-control' placeholder='参数标识'id='paraId"+i+"'>";
			ibody += "<input class='form-control' placeholder='参数名称'id='paraName"+i+"'>";
			ibody += "<input class='form-control' placeholder='参数类型'id='paraType"+i+"'>";
			ibody += "<input class='form-control' placeholder='参数描述'id='paraDesc"+i+"'>";
			ibody += "<input class='form-control' placeholder='物理量纲'id='paraPhy"+i+"'>";
			ibody += "<input class='form-control' type='number' placeholder='最大值'id='paraMax"+i+"'>";
			ibody += "<input class='form-control' type='number' placeholder='最小值'id='paraMin"+i+"'>";
			ibody += "<input class='form-control' type='number' placeholder='默认值'id='paraDefault"+i+"'>";
			ibody += "<button id='buttonUp"+i+"'onclick='goUp(this);' >⏫</button>";
			ibody += "<button id='buttonDown"+i+"'onclick='goDown(this);' >⏬</button>";
			ibody += "</div>";
			$("#addArea").append(ibody);
		
		}
	})
			$("#addArea").change(function(){
				var iparaCount=$("#iparaCount").val();
				var body="";
				for(var i=1;i<=iparaCount;i++){
					var paraType = $("#paraType"+i).val();
					if(iparaCount==1){
						body += paraType;
						$("#iparalist").val(body);
						break;
					}else{
						if(paraType==""){
							$("#iparalist").val(body);
							continue;}
						if(i==iparaCount){
							body += paraType;
							$("#iparalist").val(body);
							continue;}
						body += paraType+",";
					}
					$("#iparalist").val(body);
				}
			})
}


//参数上移
function goUp(e){
	//第一行点击up按钮;
	var p = $(e).parent().find("input").eq(0).val();
	
	if(p==1){
		toastr.error('非法操作!');
		return;
	}else{
		var q =p-1;
		
		var temp ;
		temp = $("#paraAttr"+p).val();
		$("#paraAttr"+p).val($("#paraAttr"+q).val());
		$("#paraAttr"+q).val(temp);
		
		temp = $("#paraId"+p).val();
		$("#paraId"+p).val($("#paraId"+q).val());
		$("#paraId"+q).val(temp);
		
		temp = $("#paraName"+p).val();
		$("#paraName"+p).val($("#paraName"+q).val());
		$("#paraName"+q).val(temp);
		
		temp = $("#paraType"+p).val();
		$("#paraType"+p).val($("#paraType"+q).val());
		$("#paraType"+q).val(temp);
		
		temp = $("#paraDesc"+p).val();
		$("#paraDesc"+p).val($("#paraDesc"+q).val());
		$("#paraDesc"+q).val(temp);
		
		temp = $("#paraPhy"+p).val();
		$("#paraPhy"+p).val($("#paraPhy"+q).val());
		$("#paraPhy"+q).val(temp);
		
		temp = $("#paraMax"+p).val();
		$("#paraMax"+p).val($("#paraMax"+q).val());
		$("#paraMax"+q).val(temp);
		
		temp = $("#paraMin"+p).val();
		$("#paraMin"+p).val($("#paraMin"+q).val());
		$("#paraMin"+q).val(temp);
		
		temp = $("#paraDefault"+p).val();
		$("#paraDefault"+p).val($("#paraDefault"+q).val());
		$("#paraDefault"+q).val(temp);
		
		var iparaCount=$("#iparaCount").val();
		var body="";
		for(var i=1;i<=iparaCount;i++){
			var paraType = $("#paraType"+i).val();
			if(iparaCount==1){
				body += paraType;
				$("#iparalist").val(body);
				break;
			}else{
				if(paraType==""){
					$("#iparalist").val(body);
					continue;}
				if(i==iparaCount){
					body += paraType;
					$("#iparalist").val(body);
					continue;}
				body += paraType+",";
			}
			$("#iparalist").val(body);
		}
	}
}


//参数下移
function goDown(e){
	//最后一行点击down按钮;
	var p = $(e).parent().find("input").eq(0).val();
	var iparaCount=$("#iparaCount").val();
	
	if(p==iparaCount){
		toastr.error('非法操作!');
		return;
	}else{
		var q = p-0+1;
		var temp ;	
		temp = $("#paraAttr"+p).val();
		$("#paraAttr"+p).val($("#paraAttr"+q).val());
		$("#paraAttr"+q).val(temp);
		
		temp = $("#paraId"+p).val();
		$("#paraId"+p).val($("#paraId"+q).val());
		$("#paraId"+q).val(temp);
		
		temp = $("#paraName"+p).val();
		$("#paraName"+p).val($("#paraName"+q).val());
		$("#paraName"+q).val(temp);
		
		temp = $("#paraType"+p).val();
		$("#paraType"+p).val($("#paraType"+q).val());
		$("#paraType"+q).val(temp);
		
		temp = $("#paraDesc"+p).val();
		$("#paraDesc"+p).val($("#paraDesc"+q).val());
		$("#paraDesc"+q).val(temp);
		
		temp = $("#paraPhy"+p).val();
		$("#paraPhy"+p).val($("#paraPhy"+q).val());
		$("#paraPhy"+q).val(temp);
		
		temp = $("#paraMax"+p).val();
		$("#paraMax"+p).val($("#paraMax"+q).val());
		$("#paraMax"+q).val(temp);
		
		temp = $("#paraMin"+p).val();
		$("#paraMin"+p).val($("#paraMin"+q).val());
		$("#paraMin"+q).val(temp);
		
		temp = $("#paraDefault"+p).val();
		$("#paraDefault"+p).val($("#paraDefault"+q).val());
		$("#paraDefault"+q).val(temp);
		
		var body="";
		for(var i=1;i<=iparaCount;i++){
			var paraType = $("#paraType"+i).val();
			if(iparaCount==1){
				body += paraType;
				$("#iparalist").val(body);
				break;
			}else{
				if(paraType==""){
					$("#iparalist").val(body);
					continue;}
				if(i==iparaCount){
					body += paraType;
					$("#iparalist").val(body);
					continue;}
				body += paraType+",";
			}
			$("#iparalist").val(body);
		}
	}
}




//展示接口参数的详情	
function qryInterfaceParaDetail(interfaceId,interfaceParaCount,interfaceParaList){
	$("#paraArea").empty();	 
	$.ajax({
				url:"/QryInterfaceParaDetail",
				type:"POST",
				async:true,
				data:{
					"interfaceId":interfaceId,
					"interfaceParaCount":interfaceParaCount,
					"interfaceParaList":interfaceParaList
				},
				success:function(result){
				for(var i=0;i<result.length;i++){
					var paraAttr = result[i].para_attr;
					var paraType = result[i].para_type;
					var paraId = result[i].para_id;
					var paraDesc = result[i].para_desc;
					var paraPhy =result[i].para_phy_dim;
					var paraDefault =result[i].para_default;
					var paraMax = result[i].para_max;
					var paraMin = result[i].para_min;
					var body="";
					   	body +="<div class='input-group'>";
						body += 	"<div class='input-group-prepend'>";
						body +="<span class='input-group-text'>属性</span>";
						body +=		 "<span class='input-group-text' >"+paraAttr+"</span>";
						body +=	 "</div>" ;
						body +=	 "<div class='input-group-prepend'>";
						body +="<span class='input-group-text'style='margin-left:5px;'>类型</span>";
						body +=	 "<span class='input-group-text'  style='width:65px;'>"+paraType+"</span>";
						body +=	 "</div>";
						body +=	 "<div class='input-group-prepend'>";
						body +="<span class='input-group-text'style='margin-left:5px;'>标识</span>";
						body +=	 	"<span class='input-group-text' style='width:110px;'>"+paraId+"</span>";
						body +=	 "</div>" ;
						body +=    "<div class='input-group-prepend'>";
						body +=        "<span class='input-group-text'style='margin-left:5px;'>描述</span>";
						body +=    "</div>" ;
						
						if((paraPhy!="")&&(paraPhy!=null)){
							paraDesc +="【物理量纲:"+paraPhy+"】";}
						if((paraMax!="" && paraMin!="")&&(paraMax!=null && paraMin!=null)){
							paraDesc +="【取值范围:("+paraMin+","+paraMax+")】";}
						if((paraDefault!="")&&(paraDefault!=null)){
							paraDesc +="【默认值:"+paraDefault+"】";}	
						body +=	"<input type='text'  readonly='readonly'  class='form-control' value='"+paraDesc+"'/>";
						body +="</div>";
						$("#paraArea").append(body);
						paraDesc="";
				 }
				},	
				error:function(result){
					toastr.warning('未知错误,请联系管理员!');
				}
			});	
	 }


//新增接口系列操作
function addSave(){
	//接口信息
	var iinterfaceId = $("#iinterfaceId").val();
	var iinterfaceName =$("#iinterfaceName").val();
	var iinterfaceDesc =$("#iinterfaceDesc").val();
	var iinterfaceRemark =$("#iinterfaceRemark").val();
	var iinterfaceRetnTyp =$("#iinterfaceRetnTyp").val();
	var iinterfaceRetnDesc =$("#iinterfaceRetnDesc").val();
	var iinterfaceCls =$("#iinterfaceCls").val();
	var iinterfaceParaList =$("#iparalist").val();
	var iinterfaceParaCount =$("#iparaCount").val();
	
	if(iinterfaceId==""||iinterfaceName==""||iinterfaceDesc==""||iinterfaceRetnTyp==""||iinterfaceRetnDesc==""){
		toastr.info('接口必填项未填写充分!');
		return ;
	}

	if(iinterfaceParaCount != "" ){
		var interfaceMap = new Array();
		interfaceMap.push({
			interfaceId :iinterfaceId,
			interfaceName :iinterfaceName,
			interfaceDesc :iinterfaceDesc,
			interfaceRemark :iinterfaceRemark,
			interfaceRetnTyp :iinterfaceRetnTyp,
			interfaceRetnDesc :iinterfaceRetnDesc,
			interfaceCls :iinterfaceCls,
			interfaceParaList :iinterfaceParaList,
			interfaceParaCount :iinterfaceParaCount});
		
		var paraListMap = new Array();
		for(var i=1;i<=iinterfaceParaCount;i++){
			var paraAttr =$("#paraAttr"+i).val();
			var paraId = $("#paraId"+i).val();
			var paraName = $("#paraName"+i).val();
			var paraType = $("#paraType"+i).val();
			var paraNo = $("#paraNo"+i).val();
			var paraDesc = $("#paraDesc"+i).val();
			var paraPhy = $("#paraPhy"+i).val();
			var paraMax = $("#paraMax"+i).val();
			var paraMin = $("#paraMin"+i).val();
			var paraDefault = $("#paraDefault"+i).val();
			
			
			if(paraAttr==""||paraId==""||paraName==""||paraType==""||paraNo==""||paraDesc==""){
				toastr.info('接口参数中必填项未填写充分!');
				return ;
			}
			
			
			
			paraListMap.push({
				paraAttr:paraAttr,
				paraId:paraId,
				paraName:paraName,
				paraType:paraType,
				paraNo:paraNo,
				paraDesc:paraDesc,
				paraPhy:paraPhy,
				paraMax:paraMax,
				paraMin:paraMin,
				paraDefault:paraDefault})
				
		}
		//新增
		$.ajax({
			url:"/InsertInterface",
			type:"POST",
			async:true,
			data:{
				"interfaceMap":JSON.stringify(interfaceMap),
				"paraListMap":JSON.stringify(paraListMap)
				
			},
			success:function(result){
				if(result=="Exist"){
					toastr.error('接口已存在!重复!');
				}else if(result=="ParaExist"){
					toastr.error('接口参数已存在!重复!');
				}else if(result == "InsertParaFail"){
					toastr.error('接口参数新增失败!');
				}else if(result=="InsertInterfaceFail"){
					toastr.error('接口新增失败!');
				}else if(result=="SUCCESS"){
					 $("#modal-add").modal('hide'); 
					 var oldTable = $('#example1').dataTable();
			   		    oldTable.fnClearTable(); 
			  		    oldTable.fnDestroy();
						QryClsInterface();
						QryInterParaCount();
						QryInterReturnType();
				}
					
			},	
			error:function(result){
				toastr.warning('未知错误,请联系管理员!');
			}
		});	

	}else{
		toastr.info('请输入参数个数!');
	
	}
	
}
	  

//删除接口

function deleteClick(e){
	interfaceId=$(e).parent().parent().find("td").eq(0).text();
	interfaceParaCount=$(e).parent().parent().find("td").eq(3).text();
	interfaceParaList=$(e).parent().parent().find("td").eq(4).text();
	$.ajax({
		url:"/deleteInterface",
		type:"POST",
		async:true,
		data:{
			"interfaceId":interfaceId,
			"interfaceParaCount":interfaceParaCount,
			"interfaceParaList":interfaceParaList
		},
		success:function(result){
			var id = result.id;
			if(result.id!=""){
				deleteInterfacePara(id);
			}else{
				toastr.error('接口删除失败!');
			}
			
		},	
		error:function(result){
			toastr.warning('未知错误,请联系管理员!');
		}
	});	

}

function deleteInterfacePara(id){
	$.ajax({
		url:"/deleteInterfacePara",
		type:"POST",
		async:true,
		data:{
			"id":id
		},
		success:function(result){
			var oldTable = $('#example1').dataTable();
		    oldTable.fnClearTable(); 
		    oldTable.fnDestroy();
			QryClsInterface();
			QryInterParaCount();
			QryInterReturnType();
			
		},	
		error:function(result){
			toastr.warning('未知错误,请联系管理员!');
		}
	});	

}
//编辑接口
function editInterfaceClick(e){
	interfaceId=$(e).parent().parent().find("td").eq(0).text();
	interfaceParaCount=$(e).parent().parent().find("td").eq(3).text();
	interfaceParaList=$(e).parent().parent().find("td").eq(4).text();
	//先回填
	$.ajax({
			url:"/QryInterfaceDetail",
			type:"POST",
			async:true,
			data:{
				"interfaceId":interfaceId,
				"interfaceParaCount":interfaceParaCount,
				"interfaceParaList":interfaceParaList
			},
			success:function(result){
			$("#einterfaceId").val(result.i_id);
			$("#einterfaceName").val(result.i_name);		 
			$("#einterfaceDesc").val(result.i_desc);		 
			$("#einterfaceRemark").val(result.i_remark);
			$("#einterfaceRetnTyp").val(result.i_return);	
			$("#einterfaceRetnDesc").val(result.i_return_desc);		 
			$("#einterfaceCls").val(result.i_class);		
			},	
			error:function(result){
				toastr.warning('未知错误,请联系管理员!');
			}
		});	
	 
}
//编辑接口保存
function editInterfaceSave(){
	var interfaceName=$("#einterfaceName").val();
	var interfaceDesc=$("#einterfaceDesc").val();
	var interfaceRemark=$("#einterfaceRemark").val();
	var interfaceRetnTyp=$("#einterfaceRetnTyp").val();
	var interfaceRetnDesc=$("#einterfaceRetnDesc").val();
	 $.ajax({
			url:"/UpdateInterface",
			type:"POST",
			async:true,
			data:{
				"interfaceName":interfaceName,
				"interfaceDesc":interfaceDesc,
				"interfaceRemark":interfaceRemark,
				"interfaceRetnTyp":interfaceRetnTyp,
				"interfaceRetnDesc":interfaceRetnDesc,
				"interfaceId":interfaceId,
				"interfaceParaCount":interfaceParaCount,
				"interfaceParaList":interfaceParaList	
			},
			success:function(result){
				if(result==1){
					//刷新
					var oldTable = $('#example1').dataTable();
				    oldTable.fnClearTable(); 
				    oldTable.fnDestroy();
					QryClsInterface();
					QryInterParaCount();
					QryInterReturnType();
					
				}else{
					toastr.error('接口修改失败!');
				}
	
			},	
			error:function(result){
				toastr.warning('未知错误,请联系管理员!');
			}
		});	

}
function toPara(e){
	interfaceId=$(e).parent().parent().find("td").eq(0).text();
	interfaceParaCount=$(e).parent().parent().find("td").eq(3).text();
	interfaceParaList=$(e).parent().parent().find("td").eq(4).text();
	var uniqueInterid;
	$.ajax({
		url:"/QryInterfaceDetail",
		type:"POST",
		async:true,
		data:{
			"interfaceId":interfaceId,
			"interfaceParaCount":interfaceParaCount,
			"interfaceParaList":interfaceParaList
		},
		success:function(result){
			uniqueInterid=result.id;
			window.parent.openInside.location.href="/paraForInter?uniqueInterid="+uniqueInterid;
		},	
		error:function(result){
			toastr.warning('未知错误,请联系管理员!');
		}
	});	
	

}
function getUser(){
	$.ajax({
		url:"/getUser",
		type:"POST",
		async:true,
		success:function(result){
			if(result=="sessionNull"){
				window.parent.openInside.location.href="/tologin";			  
			}else{
				var userName =result;
				QryClsInterface();
				QryInterParaCount();
				QryInterReturnType();
			}
			
		},
		error:function(result){
			toastr.warning('未知错误,请联系管理员!');
		}
	});
	
}

</script>    

<script type="text/javascript">
toastr.options = {
		  "closeButton": true,
		  "debug": false,
		  "newestOnTop": true,
		  "progressBar": true,
		  "positionClass": "toast-top-full-width",
		  "preventDuplicates": false,
		  "onclick": null,
		  "showDuration": "300",
		  "hideDuration": "800",
		  "timeOut": "2500",
		  "extendedTimeOut": "1000",
		  "showEasing": "swing",
		  "hideEasing": "linear",
		  "showMethod": "fadeIn",
		  "hideMethod": "fadeOut"
		}

	getUser();
</script>

</body>
</html>
