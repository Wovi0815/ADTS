<!DOCTYPE html>
<html lang="en" xmlns="http://www.thymeleaf.org">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- Font Awesome -->
	 	<link rel="stylesheet" th:href="@{/plugins/fontawesome-free/css/all.min.css}"> 
		<!-- Ionicons -->
		<link rel="stylesheet" th:href="@{/dist/css/ionicons.css}">
		<!-- Tempusdominus Bbootstrap 4 -->
		<link rel="stylesheet" th:href="@{/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css}">
		<!-- iCheck -->
		<link rel="stylesheet" th:href="@{/plugins/icheck-bootstrap/icheck-bootstrap.min.css}">
		<!-- DataTables -->
  		<link rel="stylesheet" th:href="@{/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css}">
  		<link rel="stylesheet" th:href="@{/plugins/datatables-responsive/css/responsive.bootstrap4.min.css}">
		<!-- Theme style -->
		<link rel="stylesheet" th:href="@{/dist/css/adminlte.min.css}">
		<!-- overlayScrollbars -->
		<link rel="stylesheet" th:href="@{/plugins/overlayScrollbars/css/OverlayScrollbars.min.css}">
		
		<!-- Google Font: Source Sans Pro -->
		<link th:href="@{/dist/css/google.css}" rel="stylesheet">
		
		<title></title>
	
	</head>
	<body>

	<div class="modal fade" id="modal-detail">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title" id="modalTitle"></h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              	<!-- 模态框内容 -->
			<div class="form-group" id="inputPara">

			</div>
			
			<div class="form-group" id="outputPara">
			
			</div>
			
            </div>
          </div>
        </div>
      </div>
	
	
		<!-- 表格相关 -->   
            <div class="card-body">     
			<div id="select">        
	 
 		      <select class="form-control select2bs5"   style="margin-right:10%;width:15%;float:right;" id="selectReturn">
				<option>筛选条件/返回值类型</option>
		      </select>
		      
		      <select class="form-control select2bs5"   style="margin-right:5%;width:15%;float:right;" id="selectCount">
				<option>筛选条件/参数个数</option>
		      </select>
		      
       		</div>
        
       
              <table id="example1" class="table table-bordered table-striped">
                <thead>
                <tr>
                  <th>接口标识</th>
                  <th>接口名称</th>
                  <th>返回值类型</th>
                  <th>参数个数</th>
                  <th>参数类型</th>
                  <th>接口详情</th>
                  <th>操作</th>
                </tr>
                </thead>
                <tbody >
                </tbody>
              </table>
         </div>
         

	<script th:src="@{/plugins/jquery/jquery.js}" ></script>
	<script th:src="@{/plugins/bootstrap/js/bootstrap.min.js}"></script>
	<script type="module" th:src="@{/plugins/popper/popper.js}"></script>
	<!-- jQuery -->
	<script th:src="@{/plugins/jquery/jquery.min.js}"></script>
	<!-- jQuery UI 1.11.4 -->
	<script th:src="@{/plugins/jquery-ui/jquery-ui.min.js}"></script>
	<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
	 <script>
	  $.widget.bridge('uibutton', $.ui.button)
	</script> 
	<!-- Bootstrap 4 -->
	<script th:src="@{/plugins/select2/js/select2.full.min.js}"></script>
	<script th:src="@{/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js}"></script>
	<script th:src="@{/plugins/bootstrap-switch/js/bootstrap-switch.min.js}"></script>
	<script th:src="@{/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
	<!-- DataTables -->
	<script th:src="@{/plugins/datatables/jquery.dataTables.min.js}"></script>
	<script th:src="@{/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js}"></script>
	<script th:src="@{/plugins/datatables-responsive/js/dataTables.responsive.min.js}"></script>
	<script th:src="@{/plugins/datatables-responsive/js/responsive.bootstrap4.min.js}"></script>
	
	<!-- ChartJS -->
	
	<!-- Sparkline -->
	<script th:src="@{/plugins/chart.js/Chart.min.js}"></script><script th:src="@{/plugins/sparklines/sparkline.js}"></script>
	
	<!-- jQuery Knob Chart -->
	<script th:src="@{/plugins/jquery-knob/jquery.knob.min.js}"></script>
	<!-- overlayScrollbars -->
	<script th:src="@{/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js}"></script>
	<!-- AdminLTE App -->
	<script th:src="@{/dist/js/adminlte.js}"></script>

	 
	<!-- page script -->
<script type="text/javascript">

function GetRequest() {
var url = location.search; //获取url中"?"符后的字串
var theRequest = new Object();
 if (url.indexOf("?") != -1) {
       var str = url.substr(1);
       strs = str.split("&");
       for (var i = 0; i < strs.length; i++) {
           theRequest[strs[i].split("=")[0]] = decodeURIComponent(strs[i].split("=")[1]);
       }
   }
   return theRequest;
}

//------全局变量-------
var a=GetRequest();//中间件菜单传值
var classId=a['classId'];
var inintKey=true;//初始化table 开关
var selectCount ;
var selectReturn ;

//------全局变量-------

function QryClsInterface(){//查类下属接口
	$("#example1 tbody" ).empty();
	$.ajax({
		url:"/QryClsInterface.do",
		type:"POST",
		async:true,
		data:{"classId":classId},
		success:function(result){
			var body="";
			for(var i=0;i<result.length;i++){
				body = "<tr>";
				body    += "<td id='tinterfaceId'>" + result[i].i_id + "</td>";
		        body    += "<td id='tinterfaceName'>" + result[i].i_name + "</td>";
		        body    += "<td id='tinterfaceReturn'>" + result[i].i_return + "</td>";  
		        body    += "<td id='tinterfaceParaCount'>" + result[i].i_para_count + "</td>";
		        body    += "<td id='tinterfaceParaType'>" + result[i].i_para_list + "</td>";
		        body	+= "<td>"+
		        "<button id='detailBtn' type='button' style='width:70%;float: right;margin-right:15%;margin-left: 15%;'class='btn btn-block btn-outline-success btn-sm' data-toggle='modal' data-target='#modal-detail'onclick='showDetail(this)'>接口详情</button> "+
			    "</td>";
		        body    += "<td>"+
		        "<button id='addBtn'type='button' style='margin-left: 6px;width: 30%;float: left;'class='btn btn-block btn-outline-info btn-sm' data-toggle='modal' data-target='#modal-default' onclick='addClick();'>新增</button> "+
		        "<button id='editBtn' type='button' style='margin-top:0px;margin-left: 6px;width: 30%;float: left;'class='btn btn-block btn-outline-primary btn-sm' data-toggle='modal' data-target='#modal-default'onclick='editClick();'>修改</button> "+
		        "<button id='deleteBtn' type='button' style='margin-left: 6px; width: 30%;float: left; margin-top: 0px;'class='btn btn-block btn-outline-danger btn-sm'   onclick='deleteClick();'>删除</button> "+
		        "</td>";
		        body    += "</tr>";
			    $("#example1 tbody" ).append(body); 
				
			}
			
		if(inintKey){
			$("#example1").DataTable({
			      "responsive": true,
			      "autoWidth": false,
			      "paging": true,
			      "lengthChange": true,
			      "searching": false,
			      "ordering": true,
			      "info": true,
			    });
			inintKey = false;
		}
			
		},
		error:function(result){
			alert("未知错误联系管理员！");
		}
	});

}

function QryClsParaCount(){
	$.ajax({
		url:"/QryClsParaCount.do",
		type:"POST",
		async:true,
		data:{"classId":classId},
		success:function(result){
			for(var i=0;i<result.length;i++){
				var obody="";
	        	obody	+= "<option id='opitem'>"+result[i].i_para_count +"</option>";
	        	$("#selectCount" ).append(obody);
				}
		}
	});	
}
function QryClsReturnType(){
	$.ajax({
		url:"/QryClsReturnType.do",
		type:"POST",
		async:true,
		data:{"classId":classId},
		success:function(result){
			for(var i=0;i<result.length;i++){
				var obody="";
	        	obody	+= "<option id='opitem'>"+result[i].i_return +"</option>";
	        	$("#selectReturn" ).append(obody);
				}
		}
	});	
}


//根据下拉框重新刷新表格
$("#select").change(function(){
	selectReturn =$("#selectReturn").val();	
	selectCount =$("#selectCount").val();	
	if(selectReturn=="筛选条件/返回值类型"){
		selectReturn=null;
	}
	if(selectCount=="筛选条件/参数个数"){
		selectCount=null;
	}
	$("#example1 tbody" ).empty(); 
	
	$.ajax({
		url:"/QryInterfaceBySelect.do",
		type:"POST",
		async:true,
		data:{
			"selectReturn":selectReturn,
			"selectCount":selectCount,
			"classId":classId
			},
		success:function(result){
			for(var i=0;i<result.length;i++){
				body = "<tr>";
				body    += "<td id='tinterfaceId'>" + result[i].i_id + "</td>";
		        body    += "<td id='tinterfaceName'>" + result[i].i_name + "</td>";
		        body    += "<td id='tinterfaceReturn'>" + result[i].i_return + "</td>";  
		        body    += "<td id='tinterfaceParaCount'>" + result[i].i_para_count + "</td>";
		        body    += "<td id='tinterfaceParaType'>" + result[i].i_para_list + "</td>";
		        body	+= "<td>"+
		        "<button id='detailBtn' type='button' style='width:70%;float: right;margin-right:15%;margin-left: 15%;'class='btn btn-block btn-outline-success btn-sm' data-toggle='modal' data-target='#modal-detail'onclick='showDetail(this)'>接口详情</button> "+
			    "</td>";
		        body    += "<td>"+
		        "<button id='addBtn'type='button' style='margin-left: 6px;width: 30%;float: left;'class='btn btn-block btn-outline-info btn-sm' data-toggle='modal' data-target='#modal-default' onclick='addClick();'>新增</button> "+
		        "<button id='editBtn' type='button' style='margin-top:0px;margin-left: 6px;width: 30%;float: left;'class='btn btn-block btn-outline-primary btn-sm' data-toggle='modal' data-target='#modal-default'onclick='editClick();'>修改</button> "+
		        "<button id='deleteBtn' type='button' style='margin-left: 6px; width: 30%;float: left; margin-top: 0px;'class='btn btn-block btn-outline-danger btn-sm'   onclick='deleteClick();'>删除</button> "+
		        "</td>";
		        body    += "</tr>";
			    $("#example1 tbody" ).append(body); 
				
			}
		}
	});	
	
	
	
})

	
		
	
	
		
	

		
		
		
		
	











function showDetail(e){
	$("#inputPara").empty();
	 var interfaceId=$(e).parent().parent().find("td").eq(0).text();
	 var interfaceParaCount=$(e).parent().parent().find("td").eq(3).text();
	 var interfaceParaList=$(e).parent().parent().find("td").eq(4).text();
			$.ajax({
				url:"/QryInterfaceDetail.do",
				type:"POST",
				async:true,
				data:{
					"interfaceId":interfaceId,
					"interfaceParaCount":interfaceParaCount,
					"interfaceParaList":interfaceParaList
				},
				success:function(result){
				for(var i=0;i<result.length;i++){
					var paraAttr = result[i].para_attr;
					var paraType = result[i].para_type;
					var paraId = result[i].para_id;
					var paraDesc = result[i].para_desc;
					var paraPhy =result[i].para_phy_dim;
					var paraDefault =result[i].para_default;
					var paraMax = result[i].para_max;
					var paraMin = result[i].para_min;
					var body="";
					   	body +="<div class='input-group'>";
						body += 	"<div class='input-group-prepend'>";
						body +=		 "<span class='input-group-text' >"+paraAttr+"</span>";
						body +=	 "</div>" ;
						body +=	 "<div class='input-group-prepend'>";
						body +=	 	"<span class='input-group-text'  style='width:55px;'>"+paraType+"</span>";
						body +=	 "</div>";
						body +=	 "<div class='input-group-prepend'>";
						body +=	 	"<span class='input-group-text' style='margin-left:15px;width:100px;'>"+paraId+"</span>";
						body +=	 "</div>" ;
						body +=    "<div class='input-group-prepend'>";
						body +=        "<span class='input-group-text'style='margin-left:5px;'>描述</span>";
						body +=    "</div>" ;
						
						if(paraPhy!=null){
							paraDesc +="【物理量纲:"+paraPhy+"】";}
						if(paraMax!=null && paraMin!=null){
							paraDesc +="【取值范围:("+paraMin+","+paraMax+")】";}
						if(paraDefault!=null){
							paraDesc +="【默认值:"+paraDefault+"】";}	
						body +=	"<input type='text' class='form-control' value='"+paraDesc+"'/>";
						body +="</div>";
						$("#inputPara").append(body);
						paraDesc="";
				 }
				}
			});	
		
}
</script>    

<script type="text/javascript">
	QryClsInterface();
	QryClsParaCount();
	QryClsReturnType();
</script>
</body>
</html>
